package com.exemplo.leitorxml;

import org.jdom2.Document;
import org.jdom2.Element;

public class CTeParser {

    private final XMLParser xmlParser = new XMLParser();

    public void lerCTe(String caminhoArquivo) {
        Document doc = xmlParser.carregarXML(caminhoArquivo);
        Element raiz = doc.getRootElement(); // <CTe>
        Element infCte = raiz.getChild("infCte"); // <infCte>

        if (infCte == null) {
            System.out.println("Não foi possível encontrar a tag <infCte>.");
            return;
        }

        // Emitente
        Element emit = infCte.getChild("emit");
        String emitente = (emit != null) ? emit.getChildText("xNome") : "N/D";

        // Destinatário
        Element dest = infCte.getChild("dest");
        String destinatario = (dest != null) ? dest.getChildText("xNome") : "N/D";

        // CFOP (fica em <ide><CFOP>)
        Element ide = infCte.getChild("ide");
        String cfop = (ide != null) ? ide.getChildText("CFOP") : "N/D";

        // Data de emissão (fica em <ide><dhEmi>)
        String dataEmissao = (ide != null) ? ide.getChildText("dhEmi") : "N/D";

        // Situação (ativo ou cancelado — via tag <cStat> ou <procEventoCTe>)
        String situacao = "Ativo";
        Element protCTe = raiz.getChild("protCTe");
        if (protCTe != null) {
            Element infProt = protCTe.getChild("infProt");
            String cStat = (infProt != null) ? infProt.getChildText("cStat") : "";
            if ("135".equals(cStat) || "136".equals(cStat)) {
                situacao = "Cancelado";
            }
        }

        // Exibir resultado
        System.out.println("Emitente: " + emitente);
        System.out.println("Destinatário: " + destinatario);
        System.out.println("CFOP: " + cfop);
        System.out.println("Data de Emissão: " + dataEmissao);
        System.out.println("Situação: " + situacao);
    }
}
